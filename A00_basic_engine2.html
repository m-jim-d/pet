<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title>A00_basic_engine2</title>
  <meta http-equiv="content-type" content="text/html; charset=latin1">
  <style type="text/css">
td.linenos { background-color: #272822; padding-right: 10px; }
span.lineno { background-color: #272822; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #49483e }
body  { background: #272822; color: #f8f8f2 }
body .c { color: #75715e } /* Comment */
body .err { color: #960050; background-color: #1e0010 } /* Error */
body .k { color: #66d9ef } /* Keyword */
body .l { color: #ae81ff } /* Literal */
body .n { color: #f8f8f2 } /* Name */
body .o { color: #f92672 } /* Operator */
body .p { color: #f8f8f2 } /* Punctuation */
body .cm { color: #75715e } /* Comment.Multiline */
body .cp { color: #75715e } /* Comment.Preproc */
body .c1 { color: #75715e } /* Comment.Single */
body .cs { color: #75715e } /* Comment.Special */
body .ge { font-style: italic } /* Generic.Emph */
body .gs { font-weight: bold } /* Generic.Strong */
body .kc { color: #66d9ef } /* Keyword.Constant */
body .kd { color: #66d9ef } /* Keyword.Declaration */
body .kn { color: #f92672 } /* Keyword.Namespace */
body .kp { color: #66d9ef } /* Keyword.Pseudo */
body .kr { color: #66d9ef } /* Keyword.Reserved */
body .kt { color: #66d9ef } /* Keyword.Type */
body .ld { color: #e6db74 } /* Literal.Date */
body .m { color: #ae81ff } /* Literal.Number */
body .s { color: #e6db74 } /* Literal.String */
body .na { color: #a6e22e } /* Name.Attribute */
body .nb { color: #f8f8f2 } /* Name.Builtin */
body .nc { color: #a6e22e } /* Name.Class */
body .no { color: #66d9ef } /* Name.Constant */
body .nd { color: #a6e22e } /* Name.Decorator */
body .ni { color: #f8f8f2 } /* Name.Entity */
body .ne { color: #a6e22e } /* Name.Exception */
body .nf { color: #a6e22e } /* Name.Function */
body .nl { color: #f8f8f2 } /* Name.Label */
body .nn { color: #f8f8f2 } /* Name.Namespace */
body .nx { color: #a6e22e } /* Name.Other */
body .py { color: #f8f8f2 } /* Name.Property */
body .nt { color: #f92672 } /* Name.Tag */
body .nv { color: #f8f8f2 } /* Name.Variable */
body .ow { color: #f92672 } /* Operator.Word */
body .w { color: #f8f8f2 } /* Text.Whitespace */
body .mf { color: #ae81ff } /* Literal.Number.Float */
body .mh { color: #ae81ff } /* Literal.Number.Hex */
body .mi { color: #ae81ff } /* Literal.Number.Integer */
body .mo { color: #ae81ff } /* Literal.Number.Oct */
body .sb { color: #e6db74 } /* Literal.String.Backtick */
body .sc { color: #e6db74 } /* Literal.String.Char */
body .sd { color: #e6db74 } /* Literal.String.Doc */
body .s2 { color: #e6db74 } /* Literal.String.Double */
body .se { color: #ae81ff } /* Literal.String.Escape */
body .sh { color: #e6db74 } /* Literal.String.Heredoc */
body .si { color: #e6db74 } /* Literal.String.Interpol */
body .sx { color: #e6db74 } /* Literal.String.Other */
body .sr { color: #e6db74 } /* Literal.String.Regex */
body .s1 { color: #e6db74 } /* Literal.String.Single */
body .ss { color: #e6db74 } /* Literal.String.Symbol */
body .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
body .vc { color: #f8f8f2 } /* Name.Variable.Class */
body .vg { color: #f8f8f2 } /* Name.Variable.Global */
body .vi { color: #f8f8f2 } /* Name.Variable.Instance */
body .il { color: #ae81ff } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># Filename: A00_basic_engine.py</span>
<span class="c"># Author: James D. Miller; Gustavus Adolphus College.</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">default_timer</span>

<span class="k">def</span> <span class="nf">px_from_m</span><span class="p">(</span> <span class="n">x_m</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span> <span class="n">x_m</span> <span class="o">*</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;m_to_px&#39;</span><span class="p">]))</span>
        
<span class="k">def</span> <span class="nf">move</span><span class="p">(</span> <span class="n">car</span><span class="p">):</span>
    <span class="n">v_i</span> <span class="o">=</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span>
    <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">+=</span>  <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt_s</span>
    
    <span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;exact_solution&#39;</span><span class="p">]:</span>
        <span class="c">#car[&#39;x_m&#39;] += ((v_i + car[&#39;v_mps&#39;])/2.0)  * dt_s</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v_i</span> <span class="o">*</span> <span class="n">dt_s</span> <span class="o">+</span> <span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt_s</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Normal Euler&#39;s method (using v at the beginning of the frame).</span>
        <span class="c">#car[&#39;x_m&#39;] += v_i * dt_s</span>
        
        <span class="c"># Backward Euler&#39;s method (using v at the end of the frame).</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt_s</span>
    
<span class="k">def</span> <span class="nf">debug_print</span><span class="p">(</span><span class="n">name_string</span><span class="p">):</span>
    <span class="c"># Print out the values for a set of global names contained in</span>
    <span class="c"># a string and separated by commas.</span>
    
    <span class="n">names</span> <span class="o">=</span> <span class="n">name_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">print_string</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">print_string</span> <span class="o">+=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span>
    <span class="k">print</span> <span class="n">print_string</span>

<span class="k">def</span> <span class="nf">dp</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">x_corrected_exact</span><span class="p">(</span> <span class="n">car</span><span class="p">,</span> <span class="n">x_overlap</span><span class="p">):</span>
    <span class="c"># Inputs are conditions at time of collision detection. These</span>
    <span class="c"># values have signs. For example x_overlap is positive for penetration</span>
    <span class="c"># on the right end of the track.    </span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;stickiness_correction&#39;</span><span class="p">]):</span>
        
        <span class="n">x_coll_m</span> <span class="o">=</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span>
        <span class="n">v_coll_mps</span> <span class="o">=</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span>
        
        <span class="c"># Determine the car state as it passes through the wall.</span>
        <span class="c"># v_coll_mps**2 = v_wall_mps**2 + 2*a*x_overlap</span>
        <span class="n">v_wall_mps</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_coll_mps</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_overlap</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;left&#39;</span><span class="p">:</span>
            <span class="n">v_wall_mps</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_wall_mps</span><span class="p">)</span>
        
        <span class="c"># Might have to consider the case where it reverses direction during the</span>
        <span class="c"># collision (at the top of the track).</span>
                
        <span class="c"># The time expended penetrating the wall.</span>
        <span class="c"># x_coll_m = x_wall_m + ((v_wall_mps + v_coll_mps)/2.0) * t_pen   </span>
        <span class="n">t_pen</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">x_overlap</span><span class="o">/</span><span class="p">(</span><span class="n">v_wall_mps</span> <span class="o">+</span> <span class="n">v_coll_mps</span><span class="p">)</span>
        
        <span class="c"># The distance covered bouncing back from the wall in time t_pen. Change</span>
        <span class="c"># the sign (direction) of v_wall.</span>
        <span class="n">v_wall_afterbounce_mps</span> <span class="o">=</span> <span class="n">v_wall_mps</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span>
        <span class="n">x_bounce_pen</span> <span class="o">=</span> <span class="n">v_wall_afterbounce_mps</span> <span class="o">*</span> <span class="n">t_pen</span> <span class="o">+</span> <span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_pen</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;left&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x_bounce_pen</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span> <span class="n">x_bounce_pen</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x_bounce_pen</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span> <span class="n">x_bounce_pen</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="c"># The corrected position, that is, where it would be if it had bounced off the wall.</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_coll_m</span> <span class="o">-</span> <span class="n">x_overlap</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_bounce_pen</span>
        
        <span class="c"># Also need to determine the velocity at the corrected position.</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_wall_afterbounce_mps</span> <span class="o">+</span> <span class="n">t_pen</span> <span class="o">*</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span>
    
        <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">x_coll_m</span><span class="p">,</span> <span class="s">&quot;x_coll_m&quot;</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">v_coll_mps</span><span class="p">,</span> <span class="s">&quot;v_coll_mps&quot;</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">t_pen</span><span class="p">,</span> <span class="s">&quot;t_pen&quot;</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">v_wall_mps</span><span class="p">,</span> <span class="s">&quot;v_wall_mps&quot;</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">v_wall_afterbounce_mps</span><span class="p">,</span> <span class="s">&quot;v_wall_afterbounce_mps&quot;</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">x_bounce_pen</span><span class="p">,</span> <span class="s">&quot;x_bounce_pen&quot;</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">],</span> <span class="s">&quot;car[&#39;x_m&#39;]&quot;</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">],</span> <span class="s">&quot;car[&#39;v_mps&#39;]&quot;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># If no position correction, simply reverse the direction of the car.</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span>
    
<span class="k">def</span> <span class="nf">check_for_wall_collisions</span><span class="p">(</span> <span class="n">car</span><span class="p">):</span>
        
    <span class="c"># Check for a collision.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;left_edge_m&#39;</span><span class="p">]):</span>
        <span class="n">x_overlap</span> <span class="o">=</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;left_edge_m&#39;</span><span class="p">]</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;left&#39;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;right_edge_m&#39;</span><span class="p">]):</span> 
        <span class="n">x_overlap</span> <span class="o">=</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;right_edge_m&#39;</span><span class="p">]</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;right&#39;</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;none&#39;</span>
                            
    <span class="c"># Resolve the collision.</span>
    <span class="k">if</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_mark_px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">px_from_m</span><span class="p">(</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">])</span>
    
        <span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;exact_solution&#39;</span><span class="p">]:</span>
            <span class="n">x_corrected_exact</span><span class="p">(</span> <span class="n">car</span><span class="p">,</span> <span class="n">x_overlap</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;stickiness_correction&#39;</span><span class="p">]):</span>
            
                <span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;correction_version_2&#39;</span><span class="p">]):</span>
                    <span class="c"># Move the car back to the surface and then an additional</span>
                    <span class="c"># equal amount but reduced by the CR coefficient.</span>
                    <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x_overlap</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">])</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Simple stickiness correction. Move it back by the amount of the overlap.</span>
                    <span class="c"># This puts the car at the surface.</span>
                    <span class="k">if</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> 
                        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;left_edge_m&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;right_edge_m&#39;</span><span class="p">]</span>
                    
            <span class="c"># loss of (1-CR)*100% on each bounce.</span>
            <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span>  
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_mark_px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>

<span class="k">def</span> <span class="nf">build_airtrack_string</span><span class="p">(</span> <span class="n">car</span><span class="p">):</span>
    <span class="n">left_edge_px</span>  <span class="o">=</span> <span class="n">px_from_m</span><span class="p">(</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;left_edge_m&#39;</span><span class="p">])</span>
    <span class="n">right_edge_px</span> <span class="o">=</span> <span class="n">px_from_m</span><span class="p">(</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;right_edge_m&#39;</span><span class="p">])</span>
    <span class="n">display_width_px</span> <span class="o">=</span> <span class="mi">135</span>
    <span class="n">car_location_px</span> <span class="o">=</span> <span class="n">px_from_m</span><span class="p">(</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">])</span>
    
    <span class="n">string</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">display_width_px</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">car_location_px</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&#39;*&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">left_edge_px</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">right_edge_px</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&#39;|&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;track_mark_px&#39;</span><span class="p">])):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;.&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">track</span><span class="p">[</span><span class="s">&#39;show_collision_mark&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;collision_mark_px&#39;</span><span class="p">])):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;0&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span>
    <span class="k">return</span> <span class="n">string</span>            
            
<span class="k">def</span> <span class="nf">render</span><span class="p">(</span> <span class="n">car</span><span class="p">):</span>   
    <span class="n">display_string</span> <span class="o">=</span> <span class="n">build_airtrack_string</span><span class="p">(</span> <span class="n">car</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;details&#39;</span><span class="p">]:</span>
        <span class="k">print</span> <span class="n">display_string</span> <span class="o">+</span> <span class="s">&#39;x=&#39;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%6.3f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;, v=&#39;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">% .2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;, F=&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%3.0f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">fps_observed</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">display_string</span>

<span class="k">def</span> <span class="nf">pos_avg_10</span><span class="p">(</span> <span class="n">car</span><span class="p">):</span>
    <span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span> <span class="n">x_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x_list</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_list</span><span class="p">))</span>
    
<span class="k">def</span> <span class="nf">pretty_paragraphs</span><span class="p">(</span> <span class="n">text_string</span><span class="p">,</span> <span class="n">n_blanklines</span><span class="p">):</span>
    <span class="n">paragraph_list</span> <span class="o">=</span> <span class="n">text_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;||&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">paragraph_list</span><span class="p">:</span>    
        <span class="n">dedented_text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span> <span class="n">paragraph</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">dedented_text</span><span class="p">,</span> <span class="n">initial_indent</span><span class="o">=</span><span class="s">&#39;    &#39;</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_blanklines</span><span class="p">):</span> <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
  
<span class="k">def</span> <span class="nf">print_delay</span><span class="p">(</span> <span class="n">string</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">string</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span> <span class="mf">0.10</span><span class="p">)</span>
  
<span class="k">def</span> <span class="nf">try_sleep</span><span class="p">(</span> <span class="n">seconds</span><span class="p">):</span>
    <span class="c"># If you don&#39;t want to wait. Press control-c to break out of the sleep.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span> <span class="n">seconds</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">print_delay</span><span class="p">(</span><span class="s">&quot;               *      &quot;</span><span class="p">)</span>
        <span class="n">print_delay</span><span class="p">(</span><span class="s">&quot;              * *     &quot;</span><span class="p">)</span>
        <span class="n">print_delay</span><span class="p">(</span><span class="s">&quot;             *   *    &quot;</span><span class="p">)</span>
        <span class="n">print_delay</span><span class="p">(</span><span class="s">&quot;              * *     &quot;</span><span class="p">)</span>
        <span class="n">print_delay</span><span class="p">(</span><span class="s">&quot;               *      &quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s">&quot;</span>

<span class="k">def</span> <span class="nf">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n\n\n</span><span class="s">&quot;</span>
    <span class="k">print</span> <span class="s">&quot; Example #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; ---------------------&quot;</span>
    <span class="k">print</span> <span class="s">&quot; Initial x = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Initial v = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; a = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Coefficient of Restitution = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot; Stickiness correction = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;stickiness_correction&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;stickiness_correction&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;exact_solution&#39;</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&quot; Correction (version 2) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;correction_version_2&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Exact solution = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;exact_solution&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Use observed dt in next frame = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;use_observed_dt&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot; Show starting mark (</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\&quot;</span><span class="s">) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Show collision mark (</span><span class="se">\&quot;</span><span class="s">0</span><span class="se">\&quot;</span><span class="s">) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">track</span><span class="p">[</span><span class="s">&#39;show_collision_mark&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Show physics-engine output = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">[</span><span class="s">&#39;details&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot; FPS target = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Auto-Off = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;auto_off&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; Zoom (meters to px factor) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;m_to_px&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot; &quot;</span>
        
<span class="k">def</span> <span class="nf">modify</span><span class="p">(</span> <span class="n">car</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        
    <span class="k">if</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_collision_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.7</span>

        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39; </span>
<span class="s">        This first example has the car (represented by a &quot;*&quot;) starting from rest and accelerating to the left. Stickiness</span>
<span class="s">        correction is ON. There is energy loss (fractional reduction in v) after each wall collision.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses (and restarts) the run. Control-s can be used to give additional time (pause) for reading the descriptions</span>
<span class="s">        at the beginning. Control-c stops the run. Control-c can also be used to skip</span>
<span class="s">        the reading-wait at the beginning.</span>
<span class="s">        ||</span>
<span class="s">        For starters, remember that this is 1-D motion! The history of this motion moves vertically, one step at a time,</span>
<span class="s">        as the program renders each new single-line snapshot. An effective way to view this 1-D motion (animation) is to focus</span>
<span class="s">        your attention at the bottom row. The YouTube video will provide some training wheels (an annotation rectangle) to help</span>
<span class="s">        you do this. Another approach</span>
<span class="s">        is to place a sheet of paper over everything on the screen except the bottom row.</span>
<span class="s">        ||</span>
<span class="s">        If the &quot;d&quot; option is given at the command line, the details of the physics calculation are printed with each</span>
<span class="s">        frame. This outputs, position, velocity, and frame rate.</span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.65</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.7</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;stickiness_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_collision_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39; </span>
<span class="s">        Stickiness correction is turned off which allows the overlap (penetration) to be seen. These are</span>
<span class="s">        elastic collisions (CR=1), meaning this will run until a keyboard stop or the loop counter hits its limit.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.</span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;stickiness_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_collision_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;auto_off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39; </span>
<span class="s">        All parameters are identical to example 1 except that stickiness</span>
<span class="s">        correction is OFF.</span>
<span class="s">        ||</span>
<span class="s">        Watch the wall collision. With stickiness correction turned off, the car will be allowed to render in the state of</span>
<span class="s">        collision (on the other side of the wall). But with the first bounce, due to</span>
<span class="s">        gravity and the collision-related energy losses, the car does not recover from the state of penetration (the car sticks to the wall),</span>
<span class="s">        that is, the ball does not bounce back</span>
<span class="s">        far enough to get back to the other side.</span>
<span class="s">        This leads to a state of perpetual collisions,</span>
<span class="s">        with gravity dragging the car to the left.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.      </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span>        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="o">-</span><span class="mf">10.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.8</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_collision_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39; </span>
<span class="s">        The target frame rate is set high to give an interesting display of the time-series tail. The car</span>
<span class="s">        loses speed from each</span>
<span class="s">        wall collision. Acceleration (set high) to the left (negative).</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.</span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        

        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.7</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39; </span>
<span class="s">        Acceleration is to the right (opposite direction from other examples).</span>
<span class="s">        ||</span>
<span class="s">        A collision mark (0) is displayed at the original collision position (before stickiness correction).</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.      </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.7</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;m_to_px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">30.0</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39; </span>
<span class="s">        The scaling factor between the physics engine and the renderer has decreased from the level used in example 5.</span>
<span class="s">        This effectively zooms out the view of the</span>
<span class="s">        track and the car on it. The output from the physics engine is unchanged by this;</span>
<span class="s">        all characteristics of the movement is identical to example 5.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.</span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>   

    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">        The CR value of unity yields elastic collisions. The frame rate is set high so to give</span>
<span class="s">        the highest precision in the physics predictions. Note the car consistently returns to the initial starting point</span>
<span class="s">        as marked by the period symbol on the track.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.    </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">        This is like the previous example (7), except the target frame rate is reduced to give</span>
<span class="s">        the lower precision in the physics predictions.</span>
<span class="s">        Note the car does NOT return to the initial starting point (as marked on the track by column of period symbols).</span>
<span class="s">        ||</span>
<span class="s">        The &quot;0&quot;s are very visible in this example. As mentioned before, these are marks to indicate the</span>
<span class="s">        position of the car at the time of collision detection (before stickiness correction</span>
<span class="s">        is applied to resolve the state of overlap).</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.    </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;use_observed_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">        The observed dt is used in the subsequent frame to calculate the</span>
<span class="s">        physics engine motions.</span>
<span class="s">        All other settings are identical to those in example 8.</span>
<span class="s">        Note the car, again, does NOT return to the initial starting point (as marked on the track by column of period symbols).</span>
<span class="s">        But here the return behavior is more variable.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.    </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;exact_solution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">        The Euler-method calculation has been replaced</span>
<span class="s">        with an exact calculation method in this example. The calculation uses physics kinematics equations</span>
<span class="s">        to model the motion between the ends of the track and also the motion in the collision frames. The frame rate is set low to give</span>
<span class="s">        the most severe test for this exact method. Note the car consistently returns to the initial starting point.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.   </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;exact_solution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;use_observed_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">        The observed dt is used in subsequent frames. Note that in contrast to example 9, the car consistently returns to the initial starting point.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.   </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
    <span class="k">elif</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;v_mps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">car</span><span class="p">[</span><span class="s">&#39;a_mps2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;CR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.8</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">track</span><span class="p">[</span><span class="s">&#39;show_start_mark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;exact_solution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;use_observed_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">        Same as example 11 but with a CR of less than 1.0.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.    </span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>        
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;--&gt; Defaults&quot;</span>
        <span class="n">print_header</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
        <span class="n">explaination</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39; </span>
<span class="s">        No command line arguments were supplied or there was no match for the mode value. Default parameters will be used.</span>
<span class="s">        ||</span>
<span class="s">        Control-s pauses the run. Control-c stops the run.</span>
<span class="s">        &#39;&#39;&#39;</span>
        <span class="n">pretty_paragraphs</span><span class="p">(</span> <span class="n">explaination</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">try_sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">at_rest</span><span class="p">(</span> <span class="n">car</span><span class="p">):</span>
    <span class="n">avg_car_position</span> <span class="o">=</span> <span class="n">pos_avg_10</span><span class="p">(</span> <span class="n">car</span><span class="p">)</span>
    <span class="n">rest_tolerance</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="k">if</span>  <span class="p">(</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">avg_car_position</span> <span class="o">-</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;left_edge_m&#39;</span><span class="p">])</span>  <span class="o">&lt;</span> <span class="n">rest_tolerance</span><span class="p">)</span> <span class="ow">or</span>
          <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">avg_car_position</span> <span class="o">-</span> <span class="n">track</span><span class="p">[</span><span class="s">&#39;right_edge_m&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">rest_tolerance</span><span class="p">)</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
        
<span class="k">def</span> <span class="nf">cl_args_init</span><span class="p">():</span>
    <span class="n">cl</span><span class="p">[</span><span class="s">&#39;n_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;n_args&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cl</span><span class="p">[</span><span class="s">&#39;example_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
     
    <span class="n">cl</span><span class="p">[</span><span class="s">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>     
    <span class="k">if</span> <span class="n">cl</span><span class="p">[</span><span class="s">&#39;n_args&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;d&quot;</span><span class="p">:</span>
            <span class="n">cl</span><span class="p">[</span><span class="s">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>  
    <span class="k">global</span> <span class="n">env</span><span class="p">,</span> <span class="n">dt_s</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">fps_observed</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">cl</span>
    
    <span class="c"># A list to support calculating a running average of the position.</span>
    <span class="n">x_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c"># Initialize the general parameters that control the environment.</span>
    <span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;stickiness_correction&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;correction_version_2&#39;</span><span class="p">:</span><span class="bp">True</span> <span class="p">,</span>
           <span class="s">&#39;m_to_px&#39;</span><span class="p">:</span><span class="mf">55.0</span><span class="p">,</span> <span class="s">&#39;CR&#39;</span><span class="p">:</span><span class="mf">0.80</span><span class="p">,</span> <span class="s">&#39;auto_off&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;fps_target&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
           <span class="s">&#39;exact_solution&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s">&#39;use_observed_dt&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>
    
    <span class="c"># Characteristics of the air track (the 1-D range of space that the car moves along).</span>
    <span class="n">track</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;left_edge_m&#39;</span><span class="p">:</span><span class="mf">0.25</span> <span class="p">,</span> <span class="s">&#39;right_edge_m&#39;</span><span class="p">:</span><span class="mf">2.2</span><span class="p">,</span>
             <span class="s">&#39;show_start_mark&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> 
             <span class="s">&#39;collision_state&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span> 
             <span class="s">&#39;collision_mark_px&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">999</span><span class="p">,</span> <span class="s">&#39;show_collision_mark&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
    
    <span class="n">car</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;x_m&#39;</span><span class="p">:</span><span class="mf">1.1</span><span class="p">,</span> <span class="s">&#39;v_mps&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;a_mps2&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>

    <span class="c"># Use the command-line arguments if provided. Put them in a dictionary.</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;details&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s">&#39;n_args&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
    <span class="n">cl_args_init</span><span class="p">()</span>
    
    <span class="c"># Modify the initial conditions for the car and environment if command line parameters </span>
    <span class="c"># were provided.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cl</span><span class="p">[</span><span class="s">&#39;n_args&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">modify</span><span class="p">(</span> <span class="n">car</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>  
    
    <span class="n">fps_observed</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span>
    <span class="n">dt_target_s</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;fps_target&#39;</span><span class="p">]</span>
    <span class="n">dt_s</span> <span class="o">=</span> <span class="n">dt_target_s</span>
    <span class="n">dt_observed_s</span> <span class="o">=</span> <span class="n">dt_target_s</span>
    
    <span class="c"># A mark on the track where the car started at (optionally displayed)</span>
    <span class="n">track</span><span class="p">[</span><span class="s">&#39;track_mark_px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">px_from_m</span><span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s">&#39;x_m&#39;</span><span class="p">])</span>
    
    <span class="n">t_now_s</span> <span class="o">=</span> <span class="n">default_timer</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">50000</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>        
            <span class="n">t_previous_s</span> <span class="o">=</span> <span class="n">t_now_s</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">dt_observed_s</span> <span class="o">&lt;</span> <span class="mf">0.15</span><span class="p">):</span>
                <span class="n">move</span><span class="p">(</span> <span class="n">car</span><span class="p">)</span>
                <span class="n">check_for_wall_collisions</span><span class="p">(</span> <span class="n">car</span><span class="p">)</span>
                <span class="n">render</span><span class="p">(</span> <span class="n">car</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;auto_off&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">at_rest</span><span class="p">(</span> <span class="n">car</span><span class="p">):</span>
                    <span class="k">break</span>
          
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span> <span class="n">dt_target_s</span><span class="p">)</span>
            
            <span class="n">t_now_s</span> <span class="o">=</span> <span class="n">default_timer</span><span class="p">()</span>
            <span class="n">dt_observed_s</span> <span class="o">=</span> <span class="n">t_now_s</span> <span class="o">-</span> <span class="n">t_previous_s</span>
            
            <span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;use_observed_dt&#39;</span><span class="p">]:</span>
                <span class="n">dt_s</span> <span class="o">=</span> <span class="n">dt_observed_s</span>
            <span class="n">fps_observed</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt_observed_s</span>
        
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="c"># You pressed control-c.</span>
            <span class="k">print</span> <span class="s">&quot;Stopped by keyboard.&quot;</span>
            <span class="k">break</span>
        
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;There is a problem in the TRY block above: </span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="c"># The following &quot;raise&quot; will print out the traceback.</span>
            <span class="k">raise</span>
            <span class="k">break</span>
            
<span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></body>
</html>
