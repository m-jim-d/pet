<!DOCTYPE html>

<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="simple physics engines for raspberry pi">

	<title>P.E.T./Raspberry Pi</title>

	<link rel="canonical" href="https://pet.triquence.org/raspberrypi.html" />

	<link href="physics_engine.css" rel="stylesheet" type="text/css">
	<link href="dialog.css?v=4" rel="stylesheet" type="text/css">

	<link href="prism.css" rel="stylesheet">
	<script src="prism.js"></script>

	<style type="text/css">
		.bold1 {
			font-weight: bold;
			color: #000000;
		}

		.note {
			background: #f8f9fa;
			border-left: 4px solid #007bff;
			padding: 10px 0px;
			margin: 0px 0px;
			max-width: 800px;
		}

		/* for new installation section */
		ul.install {
			padding-left: 35px;
			margin: 0px 0px;
		}
	</style>

	<!-- The navigation menu -->
	<link href="sitemap.css?v=20" rel="stylesheet" type="text/css">
	<script src="jquery-3.7.1.min.js?v=3"></script>
	<script src="utilities.js?v=45"></script>
	<script src="pageStuff.js?v=3"></script>

	<!-- The navigation menu -->
	<script>
		// After the page loads...
		$(window).on('load', function () {
			pS.init({ "pageDesc": "PET: Rpi", "scrollAdjust": -10, "dialogOptions": true });
		});
	</script>

</head>

<body
	style="background-position: 0% 0%; font-family: Helvetica; background-image: none; background-repeat: repeat; background-attachment: scroll;">

	<!-- The navigation menu -->
	<div id="navDiv"></div>
	<img class="menuicon" id="opener" src="images/menu.svg" alt="" style="cursor:pointer;">

	<dialog id="cookieConsent" style="z-index:5; width:400px">
		<h2 class="dialog" id="label">Cookies<span id="dialog-status" style="font-size:30px; color:black"></span></h2>
		<p>
			This page loads YouTube videos and related cookies.
			<i>Accept</i> to view the videos as embedded on this page.
			<i>Reject</i> to decline cookies and view in a new tab.
		</p>
		<p>
			If you accept, click a video to load; click again to play.
		</p>
		<form method="dialog">
			<button class="dialog-cancel-x" id="firstDialogButton" value="close" title="close">&times;</button>
			<button class="dialog" style="float:right;" value="accept">Accept</button>
			<button class="dialog-cancel" style="float:right;" value="reject">Reject</button>
			<!-- <button class="dialog-cancel" value="close" style="float: right;">Close (no change)</button> -->
		</form>
	</dialog>

	<div class="pageblock">
		<div class="title_line">
			<h1>Music, Physics Engines, and the Raspberry Pi</h1>
			<span class="float_right">(<a class="Jump" href="javascript:history.go(-1)">return</a>)&nbsp;&nbsp;(<a
					href="index.html?pygame">P.E.T.</a>)</span>
		</div>
		<p>You're welcome to scroll down to the <a class="scroll-link" data-scroll-target="physics"
				href="#">physics-engine</a> section if you
			like. There you will find a video and&nbsp;<a class="scroll-link" data-scroll-target="installation"
				href="#">installation</a>
			instructions for the Raspberry Pi (RPi).
			(This tale is related to the
			scripts and videos presented on the
			<a href="index.html">main tutorial</a> page.)
		</p>
		<p>
			Click to <a id="cookieLink" href="#">manage</a> cookies. If you accept them, click a video to load; click
			again to play.
		</p>
		<p>
			<img class="rpi" alt="RPi" width="600" height="385" src="screenshots/P1218165_cropped-b.png" />
			<h2>First, some music</h2>
		</p>
		<p>(Written in 2015, updated 2025; much has changed.)</p>
		<p>From need to revitalize my stereo system came incentive to buy a first Raspberry Pi
			(RPi). My college-age sons had introduced me to Spotify. This amazing music
			resource needed to somehow get connected to a Bryston amplifier and
			Magneplanars that had been too quiet in recent years.</p>
		<p>A web search yielded several solutions to this &quot;connection&quot; challenge
			where new meets old. <a href="https://volumio.com/">Volumio</a> seemed like a nice approach:
			headless, and with control from my laptop or Android device. The overall
			cost of the project was about $100: </p>
		<ul>
			<li>Raspberry Pi 3 and power supply</li>
			<li><a href="https://www.hifiberry.com/">HiFiBerry DAC</a> board
				(digital to analog)<br /></li>
			<li>Edimax WiFi adapter<br />
			</li>
			<li>SD Card<br />
			</li>
			<li>
				<a href="http://www.amazon.com/GeauxRobot-Clear-Raspberry-Enclosure-Shape/dp/B00BR1IJUO">Dog Bone</a>
				case
				(picture of it; no longer an option)
				<ul>
					<li>Corner-post extensions (a couple bucks extra)</li>
				</ul>
			</li>
			<li><a href="https://volumio.com/">Volumio</a></li>
			<li>Premium Spotify account (about $10 per month).</li>
		</ul>
		<p>The photo shows the DAC board stacked (on the glowing pastic post) on top of the RPi (in the shadow
			underneath). Both are housed in the Dog Bone case. If you look carefully,
			you can see the little extensions to the case's corner metal posts that I ordered
			to accommodate the added height of the DAC board.</p>
		<p>It works well and with a significant step up from Bluetooth audio
			quality (of 2015). I like to make playlists using the Spotify client on my
			laptop and then access the playlists from the Volumio client. But you can also
			search for music directly on the Volumio client. An endless supply of
			new tunes...</p>

		<p>Volumio has integrated the functionality of
			the old Spotify Connect plugin into the main Spotify plugin. So, it's much easier to setup now, only need
			one plugin, just install the main Spotify plugin that is available in Volumio.
			Playlists are accessible via a Spotify client running on a laptop, tablet,
			phone, etc. You do this by using the &quot;Connect to a device&quot; feature in the
			Spotify client. This renders (casts) your choices (e.g. pick a song, start a
			playlist,...), in the Spotify client, onto to your Raspberry Pi which is the
			hardware host for Volumio.</p>

		<div class="video-container" data-videoID="DjifBSJNLBI">
			<img class="frameCapture" src="screenshots/RPi-cropped.png" width="600" height="425">
		</div>
		<p><h2><a name="physics"></a>Fast enough for a physics engine?</h2></p>

		<p>It seemed like only seconds after I put down my cash on the RPi-1-B+ that
			the new and improved RPi-2 was announced. Wow, a promising six-fold
			improvement in performance and a new incentive to buy. Instead of
			encouraging me to listen to new tunes, this RPi-2 would be making objects
			move on its screen and hopefully at frame rates that provide a smooth and
			stable rendering.</p>
		<p>The video here shows that, yes, RPi-2 and its 900MHz ARMv7 CPU and VideoCore IV GPU
			are enough for the job. This was taken using a
			camera aimed at the RPi's display (note that software-based screen-capture
			methods burden the RPi-2 and reduce framerates). The script file running here
			is A16c_2D_B2D_serverN.py (see corresponding
			topic on <a href="index.html?in-our-framework">Using
				Pybox2d in Our Framework</a> from the main page).</p>
		<p>Most recently,&nbsp; upgraded to a RPi-5 featuring a 64-bit quad-core Arm
			Cortex-A76 processor running at 2.4GHz, along with an 800MHz VideoCore VII
			GPU.</p>
		<p>First, I'll ask you to run a script on your RPi-5 and interact with the objects in the
			Pygame window. Most of these scripts will work with only Python and Pygame
			installed.
			(Note: to run the A06, A07, or A16 scripts, you'll need to
			follow the <a class="scroll-link" data-scroll-target="installation"
			href="#">installation</a> instructions for the Conda environment in the following
			section.)</p>
		<p>From a web browser on your RPi, download a copy of the github
			repository for these python files. Look for the green &quot;code&quot; button, click
			it and use the &quot;Download ZIP&quot; option.</p>
		
		<p>Code repository: <a href="https://github.com/m-jim-d/pet-code" target="_blank">https://github.com/m-jim-d/pet-code</a></p>
		
		<p>From the RPi file manage, naviagate to the downloaded file and right
			click it and use the &quot;Extract Here&quot; option.</p>
		<p>Then from a terminal window on the RPi-5: </p>
		
		<pre><code class="language-bash">
		cd ~/Downloads/pet-code-main
		python A15a_2D_finished_game.py
		</code></pre>
		
		<p>Note that a wildcard character (*) is helpful for typing these long filenames. For example, the second
			line can be typed using the much shorter command:</p>
		<pre><code class="language-bash">python A15a*</code></pre>
		<p><a name="controlsSummary"></a>Now it's time to use your keyboard and mouse to interact with objects in
			the Pygame window.</p>
		
		<details>
			<summary title="click to open">The commands used in the video are summarized here:</summary>
			<div style="background-color: #c8d0c8; padding: 1px 10px 5px 10px; border-radius: 5px">
				<ul>
				<li><span class="bold1">Select and Move</span>: Click and drag (grab) an
					object using the mouse. Each of the three mouse buttons
					has a differing mouse-tether spring strength. Try it. Normally this will
					auto-select the object's center, but if the "Shift" key is down, any
					point on the object can be selected.</li>
				<li><span class="bold1">Toggle gravity</span>:<span>
					</span>The "g" key acts to toggle gravity ON and OFF. This particular
					script changes the background color to blue if gravity is ON. When
					gravity is OFF, most collisions are modeled as elastic.</li>
				<li><span class="bold1">Stop all translation</span>: The
					"f" key momentarily freezes the translation of all objects. They will
					start to move again under the effects of gravity or cursor-tether
					forces.</li>
				<li><span class="bold1">Apply torque</span>: The "t" key will
					torque a selected object. Shift-"t" will torque it the other way. Try
					spinning one of the squares.</li>
				<li><span class="bold1">Stop all rotation</span>: The "r"
					key momentarily stops all rotational motion for all objects.</li>
				<li><span class="bold1">Pause the Physics Engine</span>: The "p"
					key will toggle the physics engine ON and OFF. This stops everything,
					physics and rendering. Just hit the "p" key again to wake it up.
					This is useful if you're playing the Jello Madness game. You tangle the
					jello, hit the "p" key, then give the keyboard and mouse to your
					opponent. Your opponent hits the "p" key when ready to start de-tangling
					(that also resets the jello timer). When the jello is de-tangled, the
					timer will stop. That's the score (sorry, you have to write it down).
					Now exchange rolls (your turn). Low score (time) wins.</li>
				<li class="auto-style4"><span class="bold1">Drive and shoot</span>:
					If you see a circular object with two rectangles anchored to its center,
					that's a puck, and it has a jet and a gun. The "a," "d," and "w" keys
					point and fire the jet; the "j," "l," and "i" keys point and fire the
					gun. The "s" and "k" keys are used to flip the tube directions into an
					orientation opposing the current motion of the puck; this can be useful
					in breaking (stopping). Holding down the spacebar turns on a shield that protects you
					from the bullets of an opponent (or the test puck). </li>
				<li><span class="bold1">Zoom in an out</span>: The "h" and "n" keys
					zoom the view in and out at the cursor position. If the left "Ctrl" key is down, mouse
					movem<span class="auto-style4">ent acts to pan the view.</span></li>
				<li class="auto-style4"><span class="bold1">Pick a different demo</span>:<em> </em>
					Try pressing each of the number keys above the letters on your keyboard
					(not the number pad).
					The "7" key starts up the Jello-Madness
					demo. The "8" key starts the Puck-Popper demo. If your puck gets popped
					and you want to play again, just press the "8" key again. </li>
				<li class="auto-style4"><span class="bold1">Connect a client to the server</span>: From another computer
					(either Windows or Linux) that
					has Python installed, type the following in a command line:
					<pre><code class="language-bash">python A10_2D_baseline_client.py 192.168.1.197</code></pre>
					The parameter at the end of the command is an example IP address. You'll
					need to provide the actual address of the computer hosting the
					A15a_2D_finished_game.py script (or any of the server scripts). It will print its IP address in the
					command window immediately after starting. In the video, you'll see a
					second cursor acting to manipulate objects. That's a client computer
					which has connected to the RPi server. In the video, I'm working both mice, left and
					right hands... <br />
					<br />
					The network-client user must have line-of-sight to the server's screen.
					A projector would be best for games involving more than a few players.<br />
					<br />
					If you're playing Puck-Popper and all the client's pucks have popped, you can always start a new game by pressing the "7" key. Each
					connected client will get a new puck.<br />
					<br />
					Connection difficulty, client to server, might
					be a Windows firewall issue. If all else fails, try temporarily disabling the
					firewall.
				</li>
			</ul>
			</div>
		</details>
		<p>The RPi-5 has plenty of muscle to host a Python
			physics engine. Its modest cost opens all this to teaching/learning
			environments that are not as well funded as a college J-term course: a high
			school, a community center, or even a church looking for a way to share its
			message and give the gift of learning to its parishioners and neighbors in
			its area.</p>
		
		<h2><a name="installation"></a>Installation</h2>
		<p>This guide walks through installing Miniconda and the physics/graphics packages on a Raspberry Pi 5:</p>
		<ul>
			<li>Python 3.11
				<ul>
					<li>Pygame</li>
					<li>pgu (needed for A06 and A07 scripts)</li>
					<li>pybox2d (needed for A16 scripts)</li>
			</ul>
			</li>
		</ul>
		<p>Python and Pygame may already be on your RPi. Installing this Conda environment is optional, only needed if you are running the A06, A07, or A16 scripts.</p>

		<h3>Installing Miniconda</h3>

		<ol>
			<li>Download the ARM64 Miniconda installer:
				<pre><code class="language-bash">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-aarch64.sh</code></pre>
			</li>

			<li>Make the installer executable:
				<pre><code class="language-bash">chmod +x Miniconda3-latest-Linux-aarch64.sh</code></pre>
			</li>

			<li>Run the installer:
				<pre><code class="language-bash">./Miniconda3-latest-Linux-aarch64.sh</code></pre>
			</li>

			<li>During installation:
				<ul class="install">
					<li>Review the license agreement (use spacebar to scroll)</li>
					<li>Type "yes" to accept the license when prompted</li>
					<li>Accept the default installation location when prompted</li>
					<li>Type "yes" when asked to initialize Miniconda</li>
					<li>Select "yes" to auto-start the base conda environment in new terminals</li>
				</ul>
			</li>

			<li>Close and reopen your terminal window</li>
		</ol>

		<h3>Installing Physics and Graphics Packages</h3>

		<p>Create a new conda environment with Python 3.11 (recommended for best compatibility). Run these commands, one by one:</p>

		<pre><code class="language-bash">
		conda create -n physics -c conda-forge python=3.11 pygame box2d-py
		conda activate physics
		pip install pygame-pgu
		pip install python-xlib
		</code></pre>

		<p>This installs:</p>
		<ul class="install">
			<li>Python 3.11</li>
			<li>Pygame for graphics</li>
			<li>Box2D for physics simulation</li>
			<li>PGU for GUI elements</li>
			<li>python-xlib package for updating window captions</li>
		</ul>

		<h3>Verifying the Installation</h3>

		<p>After installation, you can verify the packages are installed correctly:</p>

		<pre><code class="language-bash">
		conda list
		</code></pre>

		<p>Now, try running the A06 or A07 scripts from the box2d-pgu environment. These have a gui
			interface and depend on pgu.</p>

		<pre><code class="language-bash">
		python A07*
		</code></pre>

		<p>Next, try running one of the A16 scripts. These use Box2D and depend on box2d-py. For example, A16c is the Box2D version
			of the final game script.</p>

		<pre><code class="language-bash">
		python A16c_2D_B2D_serverN.py
		</code></pre>

		<h3>Notes</h3>
		<div class="note">
			<ul class="install">
				<li>Installation of Box2D uses box2d-py from the conda-forge channel (ARM compatibility)</li>
				<li>box2d-py works with Python 3.12, but pgu has compatibility issues.</li>
				<li>The box2d-py distribution of Box2D does not support the framework or the example files in the
					pybox2d_framework_P3 directory of the repository.
					To try the example files (and A16a_BodyTypes.py), use Windows. Follow the installation for pybox2d on the
					main PET page.</li>
				<li>The pygame display.set_caption method did not work under the Linux on my RaspberryPi. So using x_window method, set_wm_name, 
					if using Linux (requires python-xlib package). See the update_caption method of my GameWindow class.</li>
			</ul>
		</div>
		<p>
			(<a class="Jump" href="javascript:history.go(-1)">return</a>)&nbsp;&nbsp;(<a
				href="index.html?pygame">P.E.T.</a>)</p>
	</div>

</body>

</html>